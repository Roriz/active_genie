# frozen_string_literal: true

require_relative "../../test_helper"

class ActiveGenie::DataExtractor::MarketplaceTest < Minitest::Test
  PRODUCTS = [
    { input: ["Michelin Defender T+H All-Season Tire - 215/60R16 95H - \$159.99 Each", { brand: { type: 'string' }, model: { type: 'string' }, type: { type: 'string' }, size: { type: 'string' }, load_index_speed_rating: { type: 'string' }, price: { type: 'number' }, price_qualifier: { type: 'string' } }], expected: { brand: 'Michelin', model: 'Defender T+H', type: 'All-Season Tire', size: '215/60R16', load_index_speed_rating: '95H', price: 159.99, price_qualifier: 'Each' } },
    { input: ["Mobil 1 Extended Performance Full Synthetic Motor Oil 5W-30, 5 Quart - \$35.47", { brand: { type: 'string' }, product_line: { type: 'string' }, type: { type: 'string' }, product: { type: 'string' }, viscosity: { type: 'string' }, volume: { type: 'string' }, price: { type: 'number' } }], expected: { brand: 'Mobil 1', product_line: 'Extended Performance', type: 'Full Synthetic', product: 'Motor Oil', viscosity: '5W-30', volume: '5 Quart', price: 35.47 } },
    { input: ["NOCO Boost Plus GB40 1000 Amp 12-Volt UltraSafe Portable Lithium Car Battery Jump Starter - \$99.95", { brand: { type: 'string' }, product_line: { type: 'string' }, model: { type: 'string' }, amperage: { type: 'string' }, voltage: { type: 'string' }, features: { type: 'array', items: { type: 'string' } }, product_type: { type: 'string' }, price: { type: 'number' } }], expected: { brand: 'NOCO', product_line: 'Boost Plus', model: 'GB40', amperage: '1000 Amp', voltage: '12-Volt', features: ['UltraSafe', 'Portable', 'Lithium'], product_type: 'Car Battery Jump Starter', price: 99.95 } },
    { input: ["Chemical Guys HOL169 16-Piece Arsenal Builder Car Wash Kit - \$124.99", { brand: { type: 'string' }, product_code: { type: 'string' }, pieces: { type: 'integer' }, product_line: { type: 'string' }, product_type: { type: 'string' }, price: { type: 'number' } }], expected: { brand: 'Chemical Guys', product_code: 'HOL169', pieces: 16, product_line: 'Arsenal Builder', product_type: 'Car Wash Kit', price: 124.99 } },
    { input: ["Garmin DriveSmart 65 \& Traffic: GPS Navigator with 6.95\" Display - \$249.99", { brand: { type: 'string' }, model: { type: 'string' }, features: { type: 'array', items: { type: 'string' } }, product_type: { type: 'string' }, display_size: { type: 'string' }, price: { type: 'number' } }], expected: { brand: 'Garmin', model: 'DriveSmart 65', features: ['Traffic'], product_type: 'GPS Navigator', display_size: '6.95"', price: 249.99 } },
    { input: ["Ninja DZ201 Foodi 8 Quart 6-in-1 DualZone 2-Basket Air Fryer - \$179.99 (Original price: \$199.99)", { brand: { type: 'string' }, model: { type: 'string' }, capacity: { type: 'string' }, functions: { type: 'string' }, features: { type: 'string' }, current_price: { type: 'number' }, original_price: { type: 'number' } }], expected: { brand: 'Ninja', model: 'DZ201 Foodi', capacity: '8 Quart', functions: '6-in-1', features: 'DualZone 2-Basket Air Fryer', current_price: 179.99, original_price: 199.99 } },
    { input: ["KitchenAid 5-Quart Artisan Stand Mixer - Empire Red - Model KSM150PSER - \$349.99", { brand: { type: 'string' }, capacity: { type: 'string' }, product_line: { type: 'string' }, product_type: { type: 'string' }, color: { type: 'string' }, model_number: { type: 'string' }, price: { type: 'number' } }], expected: { brand: 'KitchenAid', capacity: '5-Quart', product_line: 'Artisan', product_type: 'Stand Mixer', color: 'Empire Red', model_number: 'KSM150PSER', price: 349.99 } },
    { input: ["Dyson V11 Animal Cordless Vacuum Cleaner - Purple - Certified Refurbished - \$399.99", { brand: { type: 'string' }, model: { type: 'string' }, product_type: { type: 'string' }, color: { type: 'string' }, condition: { type: 'string' }, price: { type: 'number' } }], expected: { brand: 'Dyson', model: 'V11 Animal', product_type: 'Cordless Vacuum Cleaner', color: 'Purple', condition: 'Certified Refurbished', price: 399.99 } },
    { input: ["Calphalon Premier Space Saving Hard-Anodized Nonstick 15-Piece Cookware Set - \$499.99", { brand: { type: 'string' }, product_line: { type: 'string' }, features: { type: 'array', items: { type: 'string' } }, pieces: { type: 'integer' }, product_type: { type: 'string' }, price: { type: 'number' } }], expected: { brand: 'Calphalon', product_line: 'Premier', features: ['Space Saving', 'Hard-Anodized', 'Nonstick'], pieces: 15, product_type: 'Cookware Set', price: 499.99 } },
    { input: ["Instant Pot Duo 7-in-1 Electric Pressure Cooker, 6 Quart, Stainless Steel - \$89.00", { brand: { type: 'string' }, model: { type: 'string' }, functions: { type: 'string' }, product_type: { type: 'string' }, capacity: { type: 'string' }, material: { type: 'string' }, price: { type: 'number' } }], expected: { brand: 'Instant Pot', model: 'Duo', functions: '7-in-1', product_type: 'Electric Pressure Cooker', capacity: '6 Quart', material: 'Stainless Steel', price: 89.00 } },
    { input: ["Organic Bananas - 2 lb Bunch - \$1.29", { product: { type: 'string' }, weight: { type: 'string' }, unit: { type: 'string' }, price: { type: 'number' } }], expected: { product: 'Organic Bananas', weight: '2', unit: 'lb Bunch', price: 1.29 } },
    { input: ["Kirkland Signature Organic Extra Virgin Olive Oil, 2 L (67.6 fl oz), 2-count - \$39.99", { brand: { type: 'string' }, product: { type: 'string' }, volume_metric: { type: 'string' }, volume_imperial: { type: 'string' }, count: { type: 'integer' }, price: { type: 'number' } }], expected: { brand: 'Kirkland Signature', product: 'Organic Extra Virgin Olive Oil', volume_metric: '2 L', volume_imperial: '67.6 fl oz', count: 2, price: 39.99 } },
    { input: ["Kerrygold Pure Irish Butter, Salted, 8 oz - \$3.99", { brand: { type: 'string' }, product: { type: 'string' }, variant: { type: 'string' }, weight: { type: 'string' }, price: { type: 'number' } }], expected: { brand: 'Kerrygold', product: 'Pure Irish Butter', variant: 'Salted', weight: '8 oz', price: 3.99 } },
    { input: ["Organic Free-Range Large Brown Eggs - 12 Count - \$5.99", { product: { type: 'string' }, count: { type: 'integer' }, price: { type: 'number' } }], expected: { product: 'Organic Free-Range Large Brown Eggs', count: 12, price: 5.99 } },
    { input: ["Kind Bars, Dark Chocolate Nuts \& Sea Salt, Gluten Free, 12 Count - \$14.88", { brand: { type: 'string' }, flavor: { type: 'string' }, dietary_restrictions: { type: 'array', items: { type: 'string' } }, count: { type: 'integer' }, price: { type: 'number' } }], expected: { brand: 'Kind Bars', flavor: 'Dark Chocolate Nuts \& Sea Salt', dietary_restrictions: ['Gluten Free'], count: 12, price: 14.88 } },
    { input: ["Apple iPhone 14 Pro Max, 256GB, Space Gray, Unlocked - \$1099.99", { brand: { type: 'string' }, model: { type: 'string' }, storage: { type: 'string' }, color: { type: 'string' }, condition: { type: 'string' }, price: { type: 'number' } }], expected: { brand: 'Apple', model: 'iPhone 14 Pro Max', storage: '256GB', color: 'Space Gray', condition: 'Unlocked', price: 1099.99 } },
    { input: ["Sony 65\" Class BRAVIA XR X95K 4K HDR Mini LED TV - \$1999.99 (Save \$500)", { brand: { type: 'string' }, display_size: { type: 'string' }, model: { type: 'string' }, display_type: { type: 'string' }, price: { type: 'number' }, discount: { type: 'number' } }], expected: { brand: 'Sony', display_size: '65\"', model: 'BRAVIA XR X95K', display_type: '4K HDR Mini LED TV', price: 1999.99, discount: 500 } },
    { input: ["Dell XPS 15 Laptop: 11th Gen Intel i7, 16GB RAM, 512GB SSD, 15.6\" FHD+ Display - \$1499", { brand: { type: 'string' }, model: { type: 'string' }, processor: { type: 'string' }, ram: { type: 'string' }, storage: { type: 'string' }, display: { type: 'string' }, price: { type: 'number' } }], expected: { brand: 'Dell', model: 'XPS 15', processor: '11th Gen Intel i7', ram: '16GB', storage: '512GB SSD', display: '15.6\" FHD+', price: 1499 } },
    { input: ["Bose QuietComfort 45 Wireless Noise Cancelling Headphones - Triple Black - \$329.00", { brand: { type: 'string' }, model: { type: 'string' }, type: { type: 'string' }, color: { type: 'string' }, price: { type: 'number' } }], expected: { brand: 'Bose', model: 'QuietComfort 45', type: 'Wireless Noise Cancelling Headphones', color: 'Triple Black', price: 329.00 } },
    { input: ["Samsung Galaxy Tab S8 Ultra Wi-Fi 128GB Graphite with S Pen Included - In Stock", { brand: { type: 'string' }, model: { type: 'string' }, connectivity: { type: 'string' }, storage: { type: 'string' }, color: { type: 'string' }, accessories: { type: 'array', items: { type: 'string' } }, availability: { type: 'string' } }], expected: { brand: 'Samsung', model: 'Galaxy Tab S8 Ultra', connectivity: 'Wi-Fi', storage: '128GB', color: 'Graphite', accessories: ['S Pen'], availability: 'In Stock' } },
    { input: ["Columbia Women's Arcadia II Waterproof Breathable Jacket with Hood - Size S, Red Lily - \$69.99", { brand: { type: 'string' }, category: { type: 'string' }, model: { type: 'string' }, features: { type: 'array', items: { type: 'string' } }, size: { type: 'string' }, color: { type: 'string' }, price: { type: 'number' } }], expected: { brand: 'Columbia', category: 'Women\'s', model: 'Arcadia II', features: ['Waterproof', 'Breathable', 'with Hood'], size: 'S', color: 'Red Lily', price: 69.99 } },
    { input: ["Ray-Ban Original Wayfarer Classic Sunglasses RB2140 50mm - Black/Green - \$163", { brand: { type: 'string' }, model: { type: 'string' }, product_type: { type: 'string' }, product_code: { type: 'string' }, size: { type: 'string' }, color: { type: 'string' }, price: { type: 'number' } }], expected: { brand: 'Ray-Ban', model: 'Original Wayfarer Classic', product_type: 'Sunglasses', product_code: 'RB2140', size: '50mm', color: 'Black/Green', price: 163 } },
    { input: ["Adidas Ultraboost 22 Running Shoes - Men's Size 10.5 - Cloud White/Core Black - \$190", { brand: { type: 'string' }, model: { type: 'string' }, product_type: { type: 'string' }, category: { type: 'string' }, size: { type: 'string' }, color: { type: 'string' }, price: { type: 'number' } }], expected: { brand: 'Adidas', model: 'Ultraboost 22', product_type: 'Running Shoes', category: 'Men\'s', size: '10.5', color: 'Cloud White/Core Black', price: 190 } },
    { input: ["Men's Slim-Fit Stretch Jeans - Dark Wash - Sizes 30-38 - \$49.95", { category: { type: 'string' }, type: { type: 'string' }, style: { type: 'string' }, color: { type: 'string' }, size_range: { type: 'string' }, price: { type: 'number' } }], expected: { category: 'Men\'s', type: 'Jeans', style: 'Slim-Fit Stretch', color: 'Dark Wash', size_range: '30-38', price: 49.95 } },
    { input: ["Nike Women's Dri-FIT Legend Training T-Shirt - Various Colors - 20% Off", { brand: { type: 'string' }, category: { type: 'string' }, model: { type: 'string' }, type: { type: 'string' }, colors_available: { type: 'string' }, discount_percentage: { type: 'number' } }], expected: { brand: 'Nike', category: 'Women\'s', model: 'Dri-FIT Legend', type: 'Training T-Shirt', colors_available: 'Various Colors', discount_percentage: 20 } },
    { input: ["Tomorrow, and Tomorrow, and Tomorrow: A Novel - Hardcover - by Gabrielle Zevin - Released July 5, 2022 - \$28.00", { title: { type: 'string' }, format: { type: 'string' }, author: { type: 'string' }, release_date: { type: 'string', format: 'date' }, price: { type: 'number' } }], expected: { title: 'Tomorrow, and Tomorrow, and Tomorrow: A Novel', format: 'Hardcover', author: 'Gabrielle Zevin', release_date: '2022-07-05', price: 28.00 } },
    { input: ["Harry Potter Complete Book Series Special Edition Boxed Set - J.K. Rowling - \$120.00", { title: { type: 'string' }, type: { type: 'string' }, edition: { type: 'string' }, format: { type: 'string' }, author: { type: 'string' }, price: { type: 'number' } }], expected: { title: 'Harry Potter', type: 'Complete Book Series', edition: 'Special Edition', format: 'Boxed Set', author: 'J.K. Rowling', price: 120.00 } },
    { input: ["Friends: The Complete Series Collection (25th Anniversary/Repackaged/DVD) - \$59.99", { title: { type: 'string' }, type: { type: 'string' }, edition: { type: 'string' }, format: { type: 'string' }, price: { type: 'number' } }], expected: { title: 'Friends', type: 'The Complete Series Collection', edition: '25th Anniversary/Repackaged', format: 'DVD', price: 59.99 } },
    { input: ["The Beatles: Get Back [3 Blu-ray] - Director: Peter Jackson - \$27.99", { title: { type: 'string' }, format: { type: 'string' }, discs: { type: 'integer' }, director: { type: 'string' }, price: { type: 'number' } }], expected: { title: 'The Beatles: Get Back', format: 'Blu-ray', discs: 3, director: 'Peter Jackson', price: 27.99 } },
    { input: ["Red Dead Redemption 2 - PlayStation 4 - ESRB Rating: Mature 17+ - \$39.99", { title: { type: 'string' }, platform: { type: 'string' }, rating: { type: 'string' }, price: { type: 'number' } }], expected: { title: 'Red Dead Redemption 2', platform: 'PlayStation 4', rating: 'ESRB Rating: Mature 17+', price: 39.99 } },
  ]

  PRODUCTS.each_with_index do |test, index|
    define_method("test_data_extractor_marketplace_products_#{test[:input][0].downcase.gsub(' ', '_').gsub('.', '')}") do
      result = ActiveGenie::DataExtractor::Basic.call(*test[:input])

      test[:expected].each do |key, value|
        assert result.key?(key.to_s), "Missing key: #{key}, result: #{result.to_s[0..100]}"
        assert_equal value, result[key.to_s], "Expected #{value}, but was #{result[key.to_s]}"
      end
    end
  end
end